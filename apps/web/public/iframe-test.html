<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Opentu iframe åµŒå…¥æµ‹è¯•</title>
    <style>
        body {
            margin: 0;
            padding: 20px;
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: #333;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            border-radius: 12px;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.1);
            overflow: hidden;
        }
        
        .header {
            background: linear-gradient(45deg, #667eea, #764ba2);
            color: white;
            padding: 20px;
            text-align: center;
        }
        
        .header h1 {
            margin: 0;
            font-size: 2em;
        }
        
        .header p {
            margin: 10px 0 0 0;
            opacity: 0.9;
        }
        
        .content {
            padding: 20px;
        }
        
        .test-section {
            margin-bottom: 30px;
        }
        
        .test-section h2 {
            color: #667eea;
            border-bottom: 2px solid #667eea;
            padding-bottom: 5px;
            margin-bottom: 15px;
        }
        
        .iframe-container {
            position: relative;
            width: 100%;
            height: 600px;
            border: 2px solid #e1e5e9;
            border-radius: 8px;
            margin: 10px 0;
            overflow: hidden;
            background: #f8f9fa;
        }
        
        .iframe-container iframe {
            width: 100%;
            height: 100%;
            border: none;
        }
        
        .iframe-info {
            background: #f8f9fa;
            padding: 10px 15px;
            border-radius: 6px;
            margin: 10px 0;
            font-size: 0.9em;
            border-left: 4px solid #667eea;
        }
        
        .status {
            display: inline-block;
            padding: 4px 8px;
            border-radius: 4px;
            font-size: 0.8em;
            margin-left: 10px;
        }
        
        .status.success {
            background: #d4edda;
            color: #155724;
        }
        
        .status.error {
            background: #f8d7da;
            color: #721c24;
        }
        
        .note {
            background: #fff3cd;
            color: #856404;
            padding: 12px;
            border-radius: 6px;
            border-left: 4px solid #ffc107;
            margin: 15px 0;
        }
        
        .controls {
            margin: 15px 0;
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
        }
        
        .btn {
            padding: 8px 16px;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-size: 0.9em;
            transition: all 0.2s;
        }
        
        .btn-primary {
            background: #667eea;
            color: white;
        }
        
        .btn-primary:hover {
            background: #5a6fd8;
        }
        
        .btn-secondary {
            background: #6c757d;
            color: white;
        }
        
        .btn-secondary:hover {
            background: #5a6268;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>ğŸ¨ Opentu iframe åµŒå…¥æµ‹è¯•</h1>
            <p>æ¨¡æ‹Ÿ api.tu-zi.com å’Œå…¶ä»–åŸŸååµŒå…¥å½“å‰åº”ç”¨çš„æ•ˆæœ</p>
        </div>
        
        <div class="content">
            <!-- æœ¬åœ°æµ‹è¯• - æ¨¡æ‹Ÿæœ¬åœ°åŸŸååµŒå…¥ -->
            <div class="test-section">
                <h2>æœ¬åœ°ç¯å¢ƒåµŒå…¥æµ‹è¯• <span class="status success">âœ“ å…è®¸</span></h2>
                <div class="iframe-info">
                    <strong>åœºæ™¯:</strong> æœ¬åœ°å¼€å‘ç¯å¢ƒåµŒå…¥å½“å‰åº”ç”¨<br>
                    <strong>çŠ¶æ€:</strong> æœ¬åœ°åŸŸåå·²åœ¨ç™½åå•ä¸­ï¼Œåº”è¯¥æ­£å¸¸æ˜¾ç¤º<br>
                    <strong>ç”¨é€”:</strong> éªŒè¯æœ¬åœ°å¼€å‘æ—¶çš„åµŒå…¥æ•ˆæœ
                </div>
                <div class="controls">
                    <button class="btn btn-primary" onclick="loadLocalIframe()">åµŒå…¥å½“å‰åº”ç”¨</button>
                    <button class="btn btn-secondary" onclick="reloadIframe('local-iframe')">é‡æ–°åŠ è½½</button>
                </div>
                <div class="iframe-container">
                    <iframe id="local-iframe" src="" title="æœ¬åœ°åµŒå…¥Aituåº”ç”¨"></iframe>
                </div>
            </div>

            <!-- æ¨¡æ‹Ÿ api.tu-zi.com åµŒå…¥ -->
            <div class="test-section">
                <h2>api.tu-zi.com åµŒå…¥æµ‹è¯• <span class="status success">âœ“ å…è®¸</span></h2>
                <div class="iframe-info">
                    <strong>åœºæ™¯:</strong> æ¨¡æ‹Ÿ api.tu-zi.com ç½‘ç«™åµŒå…¥å½“å‰åº”ç”¨<br>
                    <strong>çŠ¶æ€:</strong> api.tu-zi.com å·²åœ¨ç™½åå•ä¸­ï¼Œåº”è¯¥æ­£å¸¸æ˜¾ç¤º<br>
                    <strong>ç”¨é€”:</strong> éªŒè¯ç”Ÿäº§ç¯å¢ƒä¸­çš„åµŒå…¥æ•ˆæœ
                </div>
                <div class="note">
                    <strong>æ³¨æ„:</strong> è¿™ä¸ªæµ‹è¯•é¡µé¢æœ¬èº«è¿è¡Œåœ¨å½“å‰åŸŸåä¸‹ï¼Œæ‰€ä»¥å¯ä»¥æˆåŠŸåµŒå…¥ã€‚åœ¨å®é™…éƒ¨ç½²ä¸­ï¼Œapi.tu-zi.com çš„é¡µé¢å¯ä»¥é€šè¿‡åŒæ ·çš„æ–¹å¼åµŒå…¥æ­¤åº”ç”¨ã€‚
                </div>
                <div class="controls">
                    <button class="btn btn-primary" onclick="loadCurrentApp()">åµŒå…¥å½“å‰åº”ç”¨</button>
                    <button class="btn btn-primary" onclick="loadAppWithQuery('source=api.tu-zi.com')">å¸¦æ¥æºå‚æ•°åµŒå…¥</button>
                    <button class="btn btn-secondary" onclick="reloadIframe('tuzi-iframe')">é‡æ–°åŠ è½½</button>
                </div>
                <div class="iframe-container">
                    <iframe id="tuzi-iframe" src="" title="æ¨¡æ‹Ÿapi.tu-zi.comåµŒå…¥"></iframe>
                </div>
            </div>

            <!-- æœªæˆæƒåŸŸåæµ‹è¯• -->
            <div class="test-section">
                <h2>æœªæˆæƒåŸŸååµŒå…¥æµ‹è¯• <span class="status error">âœ— åº”è¯¥è¢«é˜»æ­¢</span></h2>
                <div class="iframe-info">
                    <strong>åœºæ™¯:</strong> æ¨¡æ‹ŸæœªæˆæƒåŸŸåå°è¯•åµŒå…¥å½“å‰åº”ç”¨<br>
                    <strong>çŠ¶æ€:</strong> åº”è¯¥è¢«CSPç­–ç•¥é˜»æ­¢<br>
                    <strong>ç”¨é€”:</strong> éªŒè¯å®‰å…¨ç­–ç•¥çš„æœ‰æ•ˆæ€§
                </div>
                <div class="note">
                    <strong>è¯´æ˜:</strong> ç”±äºè¿™ä¸ªæµ‹è¯•é¡µé¢è¿è¡Œåœ¨å½“å‰åŸŸåä¸‹ï¼Œæ— æ³•çœŸå®æ¨¡æ‹Ÿå¤–éƒ¨åŸŸåçš„é˜»æ­¢æ•ˆæœã€‚ä½†åœ¨å®é™…éƒ¨ç½²ä¸­ï¼Œå…¶ä»–æœªæˆæƒåŸŸåå°†æ— æ³•åµŒå…¥æ­¤åº”ç”¨ã€‚
                </div>
                <div class="controls">
                    <button class="btn btn-secondary" disabled>æ— æ³•åœ¨æ­¤æµ‹è¯•</button>
                </div>
                <div class="iframe-container">
                    <div style="padding: 50px; text-align: center; color: #666;">
                        <p>âŒ æœªæˆæƒåŸŸåå°†è¢«é˜»æ­¢åµŒå…¥</p>
                        <small>å®é™…æ•ˆæœéœ€è¦åœ¨ä¸åŒåŸŸåä¸‹æµ‹è¯•</small>
                    </div>
                </div>
            </div>

            <!-- åµŒå…¥å‚æ•°æµ‹è¯• -->
            <div class="test-section">
                <h2>åµŒå…¥å‚æ•°æµ‹è¯•</h2>
                <div class="iframe-info">
                    æµ‹è¯•ä¸åŒçš„URLå‚æ•°å’ŒåµŒå…¥é€‰é¡¹
                </div>
                <div class="controls">
                    <button class="btn btn-primary" onclick="loadWithParams('embed=true')">åµŒå…¥æ¨¡å¼</button>
                    <button class="btn btn-primary" onclick="loadWithParams('readonly=true')">åªè¯»æ¨¡å¼</button>
                    <button class="btn btn-primary" onclick="loadWithParams('toolbar=false')">éšè—å·¥å…·æ </button>
                    <button class="btn btn-secondary" onclick="clearIframe('param-iframe')">æ¸…ç©º</button>
                </div>
                <div class="iframe-container">
                    <iframe id="param-iframe" src="" title="å‚æ•°æµ‹è¯•"></iframe>
                </div>
            </div>

            <!-- CSP ç­–ç•¥è¯´æ˜ -->
            <div class="test-section">
                <h2>CSP ç­–ç•¥é…ç½®</h2>
                <div class="note">
                    ä¸ºäº†å…è®¸å½“å‰åº”ç”¨è¢«å…¶ä»–åŸŸåé€šè¿‡iframeåµŒå…¥ï¼Œéœ€è¦é…ç½®ä»¥ä¸‹HTTPå“åº”å¤´ï¼š
                    <pre style="margin: 10px 0; padding: 10px; background: #f1f3f4; border-radius: 4px; font-size: 0.85em;">Content-Security-Policy: frame-ancestors 'self' localhost:* 127.0.0.1:* https://api.tu-zi.com
X-Frame-Options: ALLOWALL</pre>
                </div>
                <div class="iframe-info">
                    <strong>å½“å‰ç­–ç•¥å…è®¸åµŒå…¥çš„çˆ¶åŸŸå:</strong><br>
                    â€¢ localhost (ä»»æ„ç«¯å£) - æœ¬åœ°å¼€å‘ç¯å¢ƒ<br>
                    â€¢ 127.0.0.1 (ä»»æ„ç«¯å£) - æœ¬åœ°IPè®¿é—®<br>
                    â€¢ https://api.tu-zi.com - ç”Ÿäº§ç¯å¢ƒæˆæƒåŸŸå<br>
                    â€¢ åŒåŸŸå (self) - åŒåŸŸå†…åµŒå…¥
                </div>
                <div class="note">
                    <strong>ä½¿ç”¨è¯´æ˜:</strong><br>
                    1. åœ¨ api.tu-zi.com çš„ç½‘ç«™ä¸­å¯ä»¥ä½¿ç”¨ <code>&lt;iframe src="ä½ çš„åº”ç”¨URL"&gt;&lt;/iframe&gt;</code> æ¥åµŒå…¥æ­¤åº”ç”¨<br>
                    2. å…¶ä»–æœªæˆæƒåŸŸåå°†æ”¶åˆ° "Refused to frame" é”™è¯¯ï¼Œæ— æ³•åµŒå…¥<br>
                    3. é…ç½®å·²æ·»åŠ åˆ° Vite å¼€å‘æœåŠ¡å™¨ã€Netlify _headers æ–‡ä»¶å’Œ netlify.toml ä¸­<br>
                    4. Netlify éƒ¨ç½²åä¼šè‡ªåŠ¨åº”ç”¨è¿™äº›CSPç­–ç•¥
                </div>
                <div class="note">
                    <strong>éªŒè¯éƒ¨ç½²:</strong><br>
                    éƒ¨ç½²åå¯ä»¥é€šè¿‡æµè§ˆå™¨å¼€å‘è€…å·¥å…·çš„ Network æ ‡ç­¾æŸ¥çœ‹å“åº”å¤´ï¼Œç¡®è®¤åŒ…å«ï¼š<br>
                    <code>Content-Security-Policy: frame-ancestors 'self' localhost:* 127.0.0.1:* *.localhost:* https://api.tu-zi.com</code>
                </div>
            </div>
        </div>
    </div>

    <script>
        // è·å–å½“å‰é¡µé¢çš„åŸºç¡€URL
        function getBaseUrl() {
            return 'https://ai-tu.netlify.app/';
        }
        
        // åŠ è½½æœ¬åœ°iframe - åµŒå…¥å½“å‰åº”ç”¨
        function loadLocalIframe() {
            const iframe = document.getElementById('local-iframe');
            const baseUrl = getBaseUrl();
            iframe.src = baseUrl;
            console.log('Embedding current app in local iframe:', baseUrl);
        }
        
        // åµŒå…¥å½“å‰åº”ç”¨
        function loadCurrentApp() {
            const iframe = document.getElementById('tuzi-iframe');
            const baseUrl = getBaseUrl();
            iframe.src = baseUrl;
            console.log('Embedding current app:', baseUrl);
        }
        
        // å¸¦æŸ¥è¯¢å‚æ•°åµŒå…¥å½“å‰åº”ç”¨
        function loadAppWithQuery(query) {
            const iframe = document.getElementById('tuzi-iframe');
            const baseUrl = getBaseUrl();
            iframe.src = `${baseUrl}?${query}`;
            console.log('Embedding current app with query:', `${baseUrl}?${query}`);
        }
        
        // å¸¦å‚æ•°åŠ è½½
        function loadWithParams(params) {
            const iframe = document.getElementById('param-iframe');
            const baseUrl = getBaseUrl();
            iframe.src = `${baseUrl}?${params}`;
            console.log('Loading with params:', `${baseUrl}?${params}`);
        }
        
        // é‡æ–°åŠ è½½æŒ‡å®šiframe
        function reloadIframe(iframeId) {
            const iframe = document.getElementById(iframeId);
            const src = iframe.src;
            iframe.src = '';
            setTimeout(() => {
                iframe.src = src;
            }, 100);
        }
        
        // æ¸…ç©ºiframe
        function clearIframe(iframeId) {
            const iframe = document.getElementById(iframeId);
            iframe.src = '';
        }
        
        // ç›‘å¬iframeåŠ è½½äº‹ä»¶
        document.addEventListener('DOMContentLoaded', function() {
            const iframes = document.querySelectorAll('iframe');
            iframes.forEach(iframe => {
                iframe.addEventListener('load', function() {
                    console.log(`Iframe loaded successfully: ${this.id}`);
                });
                
                iframe.addEventListener('error', function() {
                    console.log(`Iframe failed to load: ${this.id}`);
                });
            });
        });
        
        // æ£€æµ‹CSPè¿è§„
        document.addEventListener('securitypolicyviolation', function(e) {
            console.log('CSP Violation:', {
                directive: e.violatedDirective,
                blockedURI: e.blockedURI,
                lineNumber: e.lineNumber,
                sourceFile: e.sourceFile
            });
        });
    </script>
</body>
</html>