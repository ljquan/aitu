# Feature Specification: 批量生成数量选择

**Feature Branch**: `002-batch-generation`
**Created**: 2025-11-24
**Status**: Draft
**Input**: User description: "在AI图片/视频生成弹窗,增加生成个数输入支持点选1/2/4和输入数值.任务也需要支持同时生成多个图片或视频"

## User Scenarios & Testing *(mandatory)*

### User Story 1 - 快速选择常用生成数量 (Priority: P1)

用户在AI图片/视频生成弹窗中，希望能够快速选择常用的生成数量（1/2/4），以便快速开始生成任务。

**Why this priority**: 这是最基础的交互功能，用户需要能够选择生成数量才能使用批量生成功能。

**Independent Test**: 可以通过打开生成弹窗、点击预设数量按钮并确认选择生效来独立测试。

**Acceptance Scenarios**:

1. **Given** 用户打开AI生成弹窗, **When** 用户点击"1"按钮, **Then** 生成数量设置为1，按钮显示选中状态
2. **Given** 用户打开AI生成弹窗, **When** 用户点击"2"按钮, **Then** 生成数量设置为2，按钮显示选中状态
3. **Given** 用户打开AI生成弹窗, **When** 用户点击"4"按钮, **Then** 生成数量设置为4，按钮显示选中状态

---

### User Story 2 - 自定义输入生成数量 (Priority: P2)

用户在AI图片/视频生成弹窗中，希望能够输入自定义的生成数量，以满足特殊需求。

**Why this priority**: 补充预设选项的不足，提供更灵活的数量选择。

**Independent Test**: 可以通过在输入框中输入数值并确认生成数量更新来独立测试。

**Acceptance Scenarios**:

1. **Given** 用户打开AI生成弹窗, **When** 用户在输入框中输入"3", **Then** 生成数量设置为3
2. **Given** 用户打开AI生成弹窗, **When** 用户输入的数值超出范围, **Then** 系统显示错误提示并限制在有效范围内
3. **Given** 用户选择了预设数量后, **When** 用户修改输入框数值, **Then** 预设按钮取消选中状态，使用输入框数值

---

### User Story 3 - 批量生成任务执行 (Priority: P1)

用户提交生成任务后，系统能够根据选择的数量同时生成多个图片或视频。

**Why this priority**: 核心业务功能，确保批量生成能够正确执行。

**Independent Test**: 可以通过设置生成数量为2或更多，提交任务后检查是否生成了对应数量的结果来独立测试。

**Acceptance Scenarios**:

1. **Given** 用户设置生成数量为2, **When** 用户提交生成任务, **Then** 系统创建2个并行的生成任务
2. **Given** 用户设置生成数量为4, **When** 用户提交视频生成任务, **Then** 系统创建4个并行的视频生成任务
3. **Given** 批量任务正在执行, **When** 部分任务完成, **Then** 用户可以看到各任务的独立进度和状态

---

### User Story 4 - 批量任务结果展示 (Priority: P2)

用户能够查看批量生成任务的所有结果，并可以独立操作每个结果。

**Why this priority**: 确保用户能够有效使用批量生成的结果。

**Independent Test**: 可以通过完成批量生成后检查结果列表展示来独立测试。

**Acceptance Scenarios**:

1. **Given** 批量生成任务完成, **When** 用户查看结果, **Then** 所有生成结果以网格或列表形式展示
2. **Given** 批量生成结果展示中, **When** 用户点击单个结果, **Then** 可以对该结果进行预览、下载或插入画布操作

---

### Edge Cases

- 当用户输入0或负数时，系统应显示错误提示并使用默认值1
- 当用户输入非数字字符时，系统应自动过滤无效输入
- 当用户输入超过最大限制的数值时，系统应限制为最大值并提示用户
- 当网络中断时，已提交的批量任务应保持状态，恢复后继续执行
- 当用户在生成过程中关闭弹窗，批量任务应继续在后台执行

## Requirements *(mandatory)*

### Functional Requirements

- **FR-001**: 系统必须在AI生成弹窗中提供预设数量选择按钮（1/2/4）
- **FR-002**: 系统必须提供数字输入框允许用户输入自定义生成数量
- **FR-003**: 系统必须验证输入数量在有效范围内（1-8）
- **FR-004**: 系统必须支持预设按钮和输入框之间的状态联动
- **FR-005**: 系统必须能够根据指定数量创建多个并行生成任务
- **FR-006**: 系统必须为每个批量任务中的单个任务显示独立的进度状态
- **FR-007**: 系统必须在所有任务完成后统一展示批量生成结果
- **FR-008**: 系统必须允许用户对批量结果中的每个项目独立操作
- **FR-009**: 系统必须保存用户最近选择的生成数量作为默认值
- **FR-010**: 生成数量选择必须同时适用于图片生成和视频生成功能

### Key Entities

- **GenerationTask**: 表示单个生成任务，包含提示词、参数、状态、结果等信息
- **BatchGeneration**: 表示批量生成请求，包含生成数量、关联的多个GenerationTask、整体状态
- **GenerationResult**: 表示生成结果，包含生成的图片/视频资源、元数据、创建时间

## Success Criteria *(mandatory)*

### Measurable Outcomes

- **SC-001**: 用户可以在3秒内完成生成数量的选择（通过点击预设或输入数值）
- **SC-002**: 系统能够同时处理用户指定数量的生成任务（最多8个并行）
- **SC-003**: 批量生成的单个任务完成时间与单独生成相比增加不超过20%
- **SC-004**: 用户可以在1秒内查看到所有批量生成结果
- **SC-005**: 90%的用户能够在首次使用时成功完成批量生成操作

## Assumptions

- 最大生成数量限制为8，这是基于API限制和用户体验的平衡考虑
- 批量任务将并行执行，而非串行，以提高效率
- 用户的生成数量偏好将保存在本地存储中
- 批量生成的结果展示方式复用现有的结果展示组件
