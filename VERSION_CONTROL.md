# ç‰ˆæœ¬æ§åˆ¶å’Œç¼“å­˜ç®¡ç†

## ğŸ¯ ç‰ˆæœ¬æ§åˆ¶ç­–ç•¥

### 1. ç‰ˆæœ¬å·ç®¡ç†
é¡¹ç›®ä½¿ç”¨ [è¯­ä¹‰ç‰ˆæœ¬æ§åˆ¶ (Semantic Versioning)](https://semver.org/)ï¼š
- `MAJOR.MINOR.PATCH` (ä¾‹å¦‚: 1.2.3)
- **PATCH**: å‘åå…¼å®¹çš„é”™è¯¯ä¿®å¤
- **MINOR**: å‘åå…¼å®¹çš„æ–°åŠŸèƒ½
- **MAJOR**: ä¸å‘åå…¼å®¹çš„é‡å¤§æ›´æ”¹

### 2. å‘å¸ƒå‘½ä»¤
```bash
# è¡¥ä¸ç‰ˆæœ¬ (0.0.7 -> 0.0.8)
npm run release

# æ¬¡ç‰ˆæœ¬ (0.0.7 -> 0.1.0)  
npm run release:minor

# ä¸»ç‰ˆæœ¬ (0.0.7 -> 1.0.0)
npm run release:major

# ä»…æ„å»ºï¼ˆä¸æ›´æ–°ç‰ˆæœ¬å·ï¼‰
npm run build

# å•ç‹¬çš„ç‰ˆæœ¬å‡çº§å‘½ä»¤
npm run version:patch    # ä»…å‡çº§ç‰ˆæœ¬å·
npm run version:minor    # ä»…å‡çº§ç‰ˆæœ¬å·  
npm run version:major    # ä»…å‡çº§ç‰ˆæœ¬å·
```

## ğŸ”§ ç¼“å­˜ç®¡ç†æœºåˆ¶

### 1. Service Worker ç‰ˆæœ¬åŒ–
- æ¯æ¬¡æ„å»ºæ—¶ï¼ŒService Worker ç¼“å­˜åç§°åŒ…å«ç‰ˆæœ¬å·
- æ–°ç‰ˆæœ¬å‘å¸ƒæ—¶è‡ªåŠ¨æ¸…é™¤æ—§ç‰ˆæœ¬ç¼“å­˜
- å¼€å‘æ¨¡å¼ç¦ç”¨ç¼“å­˜ï¼Œç”Ÿäº§æ¨¡å¼å¯ç”¨å®Œæ•´ç¼“å­˜

### 2. è‡ªåŠ¨æ›´æ–°æ£€æµ‹
- åº”ç”¨æ¯5åˆ†é’Ÿæ£€æŸ¥ä¸€æ¬¡ç‰ˆæœ¬æ›´æ–°
- å‘ç°æ–°ç‰ˆæœ¬æ—¶æ˜¾ç¤ºæ›´æ–°æç¤º
- ç”¨æˆ·å¯é€‰æ‹©ç«‹å³æ›´æ–°æˆ–ç¨åæ›´æ–°

### 3. å¼ºåˆ¶ç¼“å­˜æ¸…é™¤
ç”¨æˆ·æ›´æ–°æ—¶ä¼šï¼š
1. æ¸…é™¤æ‰€æœ‰æµè§ˆå™¨ç¼“å­˜
2. å¼ºåˆ¶ Service Worker æ›´æ–°
3. é‡æ–°åŠ è½½é¡µé¢è·å–æœ€æ–°èµ„æº

## ğŸ“ ç›¸å…³æ–‡ä»¶

### ç‰ˆæœ¬æ§åˆ¶æ–‡ä»¶
- `package.json` - ç‰ˆæœ¬å·å®šä¹‰
- `scripts/safe-version-bump.js` - æ™ºèƒ½ç‰ˆæœ¬å‡çº§è„šæœ¬
- `scripts/update-version.js` - ç‰ˆæœ¬æ›´æ–°è„šæœ¬
- `apps/web/public/version.json` - è¿è¡Œæ—¶ç‰ˆæœ¬ä¿¡æ¯

### ç¼“å­˜ç®¡ç†æ–‡ä»¶
- `apps/web/public/sw.js` - Service Worker (å«ç‰ˆæœ¬åŒ–ç¼“å­˜)
- `packages/drawnix/src/components/version-update/` - ç‰ˆæœ¬æ›´æ–°ç»„ä»¶
- `apps/web/src/main.tsx` - Service Worker æ³¨å†Œå’Œæ›´æ–°é€»è¾‘

## ğŸš€ éƒ¨ç½²æµç¨‹

### å¼€å‘ç¯å¢ƒ
```bash
npm start  # å¯åŠ¨å¼€å‘æœåŠ¡å™¨ï¼Œç¦ç”¨ç¼“å­˜
```

### ç”Ÿäº§ç¯å¢ƒ
```bash
# 1. æ›´æ–°ç‰ˆæœ¬å·å¹¶æ„å»º
npm run release

# 2. éƒ¨ç½²åˆ°æœåŠ¡å™¨
# ç¡®ä¿ version.json å’Œ sw.js éƒ½åŒ…å«æ–°ç‰ˆæœ¬å·
```

## ğŸ” ç‰ˆæœ¬æ£€æŸ¥æœºåˆ¶

### 1. ç‰ˆæœ¬ä¿¡æ¯æ¥æº
- **å½“å‰ç‰ˆæœ¬**: HTML meta æ ‡ç­¾ `<meta name="app-version">`  
- **æœ€æ–°ç‰ˆæœ¬**: æœåŠ¡å™¨ `/version.json` æ¥å£

### 2. æ›´æ–°è§¦å‘æ¡ä»¶
- å®šæ—¶æ£€æŸ¥ (æ¯5åˆ†é’Ÿ)
- Service Worker æ›´æ–°äº‹ä»¶
- ç”¨æˆ·æ‰‹åŠ¨åˆ·æ–°

### 3. ç¼“å­˜ç­–ç•¥
- **å¼€å‘æ¨¡å¼**: å®Œå…¨ç¦ç”¨ç¼“å­˜ï¼Œå®æ—¶æ›´æ–°
- **ç”Ÿäº§æ¨¡å¼**: ç‰ˆæœ¬åŒ–ç¼“å­˜ï¼Œè‡ªåŠ¨æ¸…ç†æ—§ç‰ˆæœ¬

## ğŸ› ï¸ è‡ªå®šä¹‰é…ç½®

### ä¿®æ”¹æ£€æŸ¥é¢‘ç‡
åœ¨ `version-update.tsx` ä¸­ä¿®æ”¹ï¼š
```javascript
// æ¯5åˆ†é’Ÿæ£€æŸ¥ä¸€æ¬¡æ›´æ–°
const interval = setInterval(checkForUpdates, 5 * 60 * 1000);
```

### ä¿®æ”¹ç¼“å­˜ç­–ç•¥
åœ¨ `sw.js` ä¸­ä¿®æ”¹ç¼“å­˜åç§°å’Œæ¸…ç†é€»è¾‘ï¼š
```javascript
const CACHE_NAME = `drawnix-v${APP_VERSION}`;
const IMAGE_CACHE_NAME = `drawnix-images-v${APP_VERSION}`;
const STATIC_CACHE_NAME = `drawnix-static-v${APP_VERSION}`;
```

## ğŸ“Š ç›‘æ§å’Œè°ƒè¯•

### æŸ¥çœ‹å½“å‰ç‰ˆæœ¬
```javascript
// æ§åˆ¶å°ä¸­æŸ¥çœ‹
console.log(document.querySelector('meta[name="app-version"]').content);
```

### æŸ¥çœ‹ç¼“å­˜çŠ¶æ€
```javascript
// æ§åˆ¶å°ä¸­æŸ¥çœ‹æ‰€æœ‰ç¼“å­˜
caches.keys().then(console.log);
```

### Service Worker è°ƒè¯•
1. æ‰“å¼€ DevTools > Application > Service Workers
2. æŸ¥çœ‹å½“å‰ SW çŠ¶æ€å’Œç‰ˆæœ¬
3. å¯æ‰‹åŠ¨è§¦å‘æ›´æ–°æˆ–æ³¨é”€