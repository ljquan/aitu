---
name: E2E 截图标注系统
overview: 为用户手册创建带标注的截图生成系统，通过 E2E 测试自动生成包含数字圆圈、箭头文字、高亮框等标注的截图。
todos:
  - id: annotation-utils
    content: 创建截图标注工具库 screenshot-annotations.ts
    status: completed
  - id: basics-screenshots
    content: 为 basics 页面（画布操作、插入内容）添加带标注截图
    status: completed
  - id: ai-screenshots
    content: 为 AI 功能页面（视频生成、图片拆分）添加带标注截图
    status: completed
  - id: advanced-screenshots
    content: 为进阶功能页面（图片编辑、工具箱）添加带标注截图
    status: completed
  - id: drawing-screenshots
    content: 为绘图页面（思维导图、流程图）添加带标注截图
    status: completed
  - id: update-mdx
    content: 更新 MDX 文档引用新生成的截图
    status: completed
  - id: test-verify
    content: 运行测试并验证生成效果
    status: completed
isProject: false
---

# E2E 截图标注系统方案

## 技术方案

Playwright 本身不支持截图标注，但可以通过以下方式实现：

**核心思路**：在截图前，通过 `page.evaluate()` 向页面注入 overlay 标注元素，截图时自动包含标注。

### 标注工具库设计

创建 [apps/web-e2e/src/utils/screenshot-annotations.ts](apps/web-e2e/src/utils/screenshot-annotations.ts)：

```typescript
// 标注类型
interface Annotation {
  type: 'circle' | 'arrow' | 'highlight' | 'text';
  x: number;
  y: number;
  // circle: 数字圆圈标注
  number?: number;
  // arrow: 箭头 + 文字
  direction?: 'left' | 'right' | 'up' | 'down';
  label?: string;
  // highlight: 高亮框
  width?: number;
  height?: number;
  color?: string;
}

// 主要函数
async function addAnnotations(page: Page, annotations: Annotation[]): Promise<void>
async function removeAnnotations(page: Page): Promise<void>
async function screenshotWithAnnotations(page: Page, path: string, annotations: Annotation[]): Promise<void>
```

## 缺少截图的页面清单

| 页面 | 需要的截图 | 标注类型 |

|------|-----------|---------|

| basics/canvas-navigation | 视图导航控件、手形工具、缩放控件 | 数字圆圈 + 高亮框 |

| basics/insert-content | 工具栏图片按钮、拖拽上传示意 | 箭头文字 |

| ai-generation/video-generation | 视频模型选择、首尾帧上传 | 数字圆圈 |

| ai-generation/image-split | 九宫格拆分操作 | 高亮框 |

| advanced/image-preview-edit | 预览界面、编辑工具栏、裁剪/滤镜面板 | 数字圆圈 + 箭头 |

| advanced/toolbox | 工具列表、新窗口按钮 | 高亮框 |

| drawing/mindmap | 节点操作、Tab/Enter 添加节点 | 数字圆圈 |

| drawing/flowchart | 形状工具、连接线操作 | 箭头文字 |

## 实现文件

1. **标注工具库**: [apps/web-e2e/src/utils/screenshot-annotations.ts](apps/web-e2e/src/utils/screenshot-annotations.ts)

   - `addCircleNumber()` - 添加数字圆圈
   - `addArrowText()` - 添加箭头 + 文字
   - `addHighlightBox()` - 添加高亮框
   - `screenshotWithAnnotations()` - 带标注截图

2. **E2E 测试文件**: 更新 [apps/web-e2e/src/manual-gen/](apps/web-e2e/src/manual-gen/) 目录下的测试

3. **MDX 文档**: 更新对应 MDX 文件添加 Screenshot 组件引用

## 标注样式设计

```css
/* 数字圆圈 */
.annotation-circle {
  background: #F39C12;
  color: white;
  border-radius: 50%;
  width: 28px;
  height: 28px;
  font-weight: bold;
  border: 2px solid white;
  box-shadow: 0 2px 8px rgba(0,0,0,0.3);
}

/* 箭头文字 */
.annotation-arrow {
  background: rgba(243, 156, 18, 0.9);
  color: white;
  padding: 4px 12px;
  border-radius: 4px;
}

/* 高亮框 */
.annotation-highlight {
  border: 3px solid #F39C12;
  border-radius: 8px;
  background: rgba(243, 156, 18, 0.1);
}
```

## 预计新增截图 (约 25 张)

- basics: 5 张 (canvas-navigation 3, insert-content 2)
- ai-generation: 6 张 (video-generation 3, image-split 3)
- advanced: 8 张 (image-preview-edit 5, toolbox 3)
- drawing: 6 张 (mindmap 3, flowchart 3)