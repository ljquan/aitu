## 元素选择

画板中有三类元素：
- 图片
- 文字
- 图形（图片、文字之外的都是图形）
选中元素,点击"AI 图像生成"按钮打开弹窗的处理规则如下：
现有规则：把选中的图片全部插入到AI 图像生成表单的图片列表，把选中的文字填入到AI 图像生成表单的图像描述。
针对存在图形的情况，新增规则：
1、如果存在图形元素，图形元素与之重叠的元素都变成图形元素，比如图片或文字和图形有重叠（位置相交），则图片或文字变成该图形元素的一部分。所有图形元素组合起来生成一张图片，插入到AI 图像生成表单的图片列表末尾。
2、剩余的所有图片分别插入到AI 图像生成表单的图片列表开头。
3、剩余的所有文字填入到AI 图像生成表单的图像描述。
4、如果文字与图片重叠，则把文字和图片作为一个整体生成一个图片（todo）


### 插入
关闭弹窗,原先被选中的元素不应被取消选中状态   
点击插入，如果打开弹窗前，有选中的元素，图片应该插入到在所有选中元素的几何中心的最下方+20px位置。


## 视频
点击单个图片的popup-toolbar(只有图片才需要),添加一个AI生成视频按钮,点击AI生成视频按钮打开类似'/Users/ljq/code/self/drawn
  ix/packages/drawnix/src/components/ttd-dialog/ai-image-generation.tsx'的弹窗,左边表单的上传图片只支持一张图,右边是生成的
  视频预览


对于视频元素,点击的popup-toolbar出现选择视频帧的图标,点击图标打开视频帧选择弹窗.视频帧选择弹窗上方默认是该视频最后一帧的图片，图片下有进度条，可以拖动或输入选择指定位置的帧图片，点击确认，插入到画布中该视频的底下。



## 代码优化
结合项目技术栈和业界最佳实践,写一个编码规范到docs目录,并把规范加入到claude规则中
仔细review一下commitid=7edd04f之后提交的所有代码,把大文件(超过500行的)拆成若干个小的文件模块,对于重复的代码请抽象成一个模块或者函数,总而言之要提升代码的可读性和可维护性.


## 工作流
实现一个基于JSON数据的工作流系统，一条工作流是一个数组，每个元素是一个工作节点，工作节点包括输入输出和调用接口的定义。基于这个工作流，可以转换成一个工作表单的UI，用户可以在工作表单上输入参数，然后点击提交按钮，工作流会根据参数调用接口，生成结果。希望这个工作流方案，可以同时解决目前的AI图像生成和AI视频生成弹窗的问题。AI图像、视频生成的工作流会定义一个icon和工作流命名，当工作流添加到draw-toolbar中时，会显示icon和工作流命名，点击icon，会打开工作流弹窗，用户可以在工作流弹窗上输入参数，然后点击提交按钮，工作流会根据参数调用接口，生成结果。这样就把AI图像、视频生成的工作流，从弹窗中抽离出来，变成一个工作流，用户可以在工作流中输入参数，然后点击提交按钮，工作流会根据参数调用接口，生成结果。